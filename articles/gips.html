<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="gips">
<title>gips • gips</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="gips">
<meta property="og:description" content="gips">
<meta property="og:image" content="https://przechoj.github.io/gips/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gips</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1.9050</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/gips.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Optimizers.html">Optimizers</a>
    <a class="dropdown-item" href="../articles/Theory.html">Theory</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/PrzeChoj/gips/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>gips</h1>
                        <h4 data-toc-skip class="author">Adam Chojecki,
Paweł Morgen, Bartosz Kołodziejek</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/PrzeChoj/gips/blob/HEAD/vignettes/gips.Rmd" class="external-link"><code>vignettes/gips.Rmd</code></a></small>
      <div class="d-none name"><code>gips.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-problem">The problem<a class="anchor" aria-label="anchor" href="#the-problem"></a>
</h2>
<p>Quite often, we have too little data to perform valid inference.
Consider the situation with multivariate Gaussian distribution, where we
have few observations compared to the number of variables. For example,
that’s the case for graphical models used in biology or medicine. In
such a setting, the usual way of finding the covariance matrix (the
maximum likelihood method) isn’t statistically applicable. What now?</p>
</div>
<div class="section level2">
<h2 id="invariance-by-permutation">Invariance by permutation<a class="anchor" aria-label="anchor" href="#invariance-by-permutation"></a>
</h2>
<p>In some cases, the interchange of variables in the vector does not
change its distribution. In the multivariate Gaussian case, it would
mean that they have the same variances and covariances with other
respective variables. For instance, in the following covariance matrix,
variables X1 and X3 are interchangeable, meaning that vectors (X1, X2,
X3) and (X3, X2, X1) have the same distribution.</p>
<p><img src="gips_files/figure-html/symvariant_matrix-1.png" width="700"></p>
<p>Now, we can state this interchangeability property in terms of
permutations. In our case, the distribution of (X1, X2, X3) is
<strong>invariant by permutation</strong> (<span class="math inline">\(1\mapsto3\)</span>, <span class="math inline">\(3\mapsto1\)</span>), or in cyclic form <span class="math inline">\((1,3)(2)\)</span>. This is equivalent to saying
that swapping the first with the third row and then swapping the first
and third columns of the covariance matrix results in the same matrix.
Then we say that this covariance matrix is <strong>invariant by
permutation</strong>.</p>
<p>Of course, in the samples collected in the real world, no perfect
equalities will be observed. Still, if the respective values in the
(poorly) estimated covariance matrix were close, adopting a particular
assumption about invariance by permutation would be a reasonable
step.</p>
</div>
<div class="section level2">
<h2 id="package-gips">Package <code>gips</code><a class="anchor" aria-label="anchor" href="#package-gips"></a>
</h2>
<p>We propose creating a set of constraints on the covariance matrix to
use the maximum likelihood method. The constraint we consider is - none
other than - invariance under permutation symmetry.</p>
<p>This package provides a way to find a <em>reasonable</em> permutation
to be used as a constraint in covariance matrix estimation. In this
case, <em>reasonable</em> means maximizing the Bayesian posterior
distribution when using a Wishart-like distribution on symmetric,
positive definite matrices as a prior. The idea, exact formulas, and
algorithm sketch are explored in another vignette that can be accessed
by <code><a href="../articles/Theory.html">vignette("Theory", package="gips")</a></code> or on its <a href="https://przechoj.github.io/gips/articles/Theory.html">pkgdown
page</a>.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<div id="spoiler1" style="display:none">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perm_size</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">1234</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="co"># Assume we don't know the mean</span></span>
<span><span class="va">sigma_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7.5</span>, <span class="fl">5</span>,   <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>,</span>
<span>                         <span class="fl">5</span>,   <span class="fl">4.5</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>,</span>
<span>                         <span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">1</span>,   <span class="fl">0.8</span>, <span class="fl">0.8</span>,</span>
<span>                         <span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.8</span>, <span class="fl">1</span>,   <span class="fl">0.8</span>,</span>
<span>                         <span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co"># sigma_matrix is a matrix invariant under permutation (3,4,5)</span></span>
<span><span class="va">number_of_observations</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">toy_example_data</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">1234</span>,</span>
<span>    code <span class="op">=</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">number_of_observations</span>,</span>
<span>                         mu <span class="op">=</span> <span class="va">mu</span>, Sigma <span class="op">=</span> <span class="va">sigma_matrix</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<button title="Click to show the data preparation" type="button" onclick="if(document.getElementById('spoiler1') .style.display=='none')
              {document.getElementById('spoiler1') .style.display=''}
            else{document.getElementById('spoiler1') .style.display='none'}">
Show/hide data preparation
</button>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PrzeChoj/gips" class="external-link">gips</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">RNGkind</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Mersenne-Twister" "Inversion"        "Rejection"</span></span>
<span>  </span>
<span><span class="va">mu</span> </span>
<span><span class="co">#&gt; [1] -7.725932  2.445988  2.185495  2.467589  7.218308</span></span>
<span>  </span>
<span><span class="va">toy_example_data</span></span>
<span><span class="co">#&gt;            [,1]       [,2]     [,3]     [,4]     [,5]</span></span>
<span><span class="co">#&gt; [1,] -11.227315  0.5132618 1.418415 2.164356 6.370510</span></span>
<span><span class="co">#&gt; [2,]  -7.405495  3.7152828 1.485077 2.299775 6.978046</span></span>
<span><span class="co">#&gt; [3,]  -5.117185  4.8388574 2.591591 3.180002 8.422600</span></span>
<span><span class="co">#&gt; [4,] -14.602237 -1.6289216 3.060582 1.918272 6.898667</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">toy_example_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4 5</span></span>
<span><span class="va">number_of_observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">toy_example_data</span><span class="op">)</span> <span class="co"># 4</span></span>
<span><span class="va">perm_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">toy_example_data</span><span class="op">)</span> <span class="co"># 5</span></span>
<span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">toy_example_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span><span class="op">$</span><span class="va">values</span> <span class="op">&gt;</span> <span class="fl">0.00000001</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<p>Note that the rank of the <code>S</code> matrix is 3, despite the
<code>number_of_observations</code> being 4. This is because
<code><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov()</a></code> estimated the mean on every column to compute
<code>S</code>.</p>
<p>We want to find reasonable additional assumptions on <code>S</code>
to make it easier to estimate.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gips.html">gips</a></span><span class="op">(</span>S <span class="op">=</span> <span class="va">S</span>, number_of_observations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">toy_example_data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span>, type <span class="op">=</span> <span class="st">"heatmap"</span><span class="op">)</span></span></code></pre></div>
<p><img src="gips_files/figure-html/toy_example_data_show2-1.png" width="700"></p>
<p>Looking at the plot, one can see the similarities between columns 3,
4, and 5. They have similar variance and covariance to each other. The 3
and 5 have similar covariance with columns 1 and 2. However, the 4 is
not far from them.</p>
<p>Let’s see if <code>gips</code> will find the relationship:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_MAP.html">find_MAP</a></span><span class="op">(</span><span class="va">g</span>, optimizer <span class="op">=</span> <span class="st">"brute_force"</span>,</span>
<span>                  return_probabilities <span class="op">=</span> <span class="cn">TRUE</span>, save_all_perms <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; Warning: The found permutation has n0 = 5 which is bigger than the number_of_observations = 4.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> The covariance matrix invariant under the found permutation does not have the likelihood properly defined.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> For more in-depth explanation, see 'Project Matrix - Equation (6)' section in `vignette('Theory', package = 'gips')` or its pkgdown page: https://przechoj.github.io/gips/articles/Theory.html.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g_map</span>, type <span class="op">=</span> <span class="st">"heatmap"</span><span class="op">)</span></span></code></pre></div>
<p><img src="gips_files/figure-html/toy_example_data_show3-1.png" width="700"></p>
<p><code>gips</code> decided that <span class="math inline">\((3,4,5)\)</span> was the most reasonable
assumption. Let’s see how much better it is:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g_map</span></span>
<span><span class="co">#&gt; The permutation (4,5)</span></span>
<span><span class="co">#&gt;  - was found after 120 log_posteriori calculations</span></span>
<span><span class="co">#&gt;  - is 4.17 times more likely than the starting, () permutation.</span></span></code></pre></div>
<p>This assumption is over two times more believable than making no
assumption. Let’s examine how reasonable are other possible
assumptions:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_probabilities_from_gips.html">get_probabilities_from_gips</a></span><span class="op">(</span><span class="va">g_map</span><span class="op">)</span></span>
<span><span class="co">#&gt;             ()          (4,5)          (3,4)        (3,4,5)          (3,5) </span></span>
<span><span class="co">#&gt; 0.067893194946 0.283096591236 0.093466164415 0.194079307932 0.052143066473 </span></span>
<span><span class="co">#&gt;          (2,3)     (2,3)(4,5)        (2,3,4)      (2,3,4,5)      (2,3,5,4) </span></span>
<span><span class="co">#&gt; 0.001373694401 0.001710706424 0.000480879912 0.000066456140 0.000068540392 </span></span>
<span><span class="co">#&gt;        (2,3,5)          (2,4)        (2,4,5)     (2,4)(3,5)      (2,4,3,5) </span></span>
<span><span class="co">#&gt; 0.000481960538 0.001562021078 0.000890490915 0.003100068788 0.000233967979 </span></span>
<span><span class="co">#&gt;          (2,5)     (2,5)(3,4)          (1,2)     (1,2)(4,5)     (1,2)(3,4) </span></span>
<span><span class="co">#&gt; 0.002539568797 0.006013763295 0.018767461252 0.065683490369 0.036754154706 </span></span>
<span><span class="co">#&gt;   (1,2)(3,4,5)     (1,2)(3,5)        (1,2,3)   (1,2,3)(4,5)      (1,2,3,4) </span></span>
<span><span class="co">#&gt; 0.070161666438 0.041858920906 0.000251459601 0.001033791650 0.000419715879 </span></span>
<span><span class="co">#&gt;    (1,2,3,4,5)    (1,2,3,5,4)      (1,2,3,5)      (1,2,4,3)    (1,2,4,5,3) </span></span>
<span><span class="co">#&gt; 0.000017132526 0.000013116877 0.004672338594 0.000027477001 0.000006983041 </span></span>
<span><span class="co">#&gt;        (1,2,4)      (1,2,4,5)   (1,2,4)(3,5)    (1,2,4,3,5)    (1,2,5,4,3) </span></span>
<span><span class="co">#&gt; 0.000066822889 0.000067273612 0.000062191654 0.000318951515 0.000007559938 </span></span>
<span><span class="co">#&gt;      (1,2,5,3)      (1,2,5,4)        (1,2,5)    (1,2,5,3,4)   (1,2,5)(3,4) </span></span>
<span><span class="co">#&gt; 0.000133792587 0.000037405606 0.000167128742 0.000217395974 0.000281925623 </span></span>
<span><span class="co">#&gt;          (1,3)     (1,3)(4,5)        (1,3,4)      (1,3,4,5)      (1,3,5,4) </span></span>
<span><span class="co">#&gt; 0.001179452433 0.001040089203 0.000077560927 0.000001911051 0.000001962057 </span></span>
<span><span class="co">#&gt;        (1,3,5)     (1,3)(2,4)   (1,3)(2,4,5)      (1,3,2,4)   (1,3,5)(2,4) </span></span>
<span><span class="co">#&gt; 0.000117198204 0.002248534839 0.000089159537 0.000576330970 0.000004983230 </span></span>
<span><span class="co">#&gt;     (1,3)(2,5)      (1,3,2,5)   (1,3,4)(2,5)          (1,4)        (1,4,5) </span></span>
<span><span class="co">#&gt; 0.022834896903 0.003402451591 0.000020551910 0.000180820494 0.000036685354 </span></span>
<span><span class="co">#&gt;     (1,4)(3,5)      (1,4,3,5)     (1,4)(2,3)   (1,4,5)(2,3)   (1,4)(2,3,5) </span></span>
<span><span class="co">#&gt; 0.000332372465 0.000004380190 0.000617950077 0.000008026443 0.000003237871 </span></span>
<span><span class="co">#&gt;     (1,4)(2,5)      (1,4,2,5)          (1,5)     (1,5)(3,4)     (1,5)(2,3) </span></span>
<span><span class="co">#&gt; 0.000321959573 0.000349379426 0.000427488844 0.000851132597 0.014277611629 </span></span>
<span><span class="co">#&gt;   (1,5)(2,3,4)     (1,5)(2,4) </span></span>
<span><span class="co">#&gt; 0.000020613306 0.000744658234</span></span></code></pre></div>
<p>We see that assumption <span class="math inline">\((3,4,5)\)</span>
is the most likely with <span class="math inline">\(19.9\%\)</span>
posterior probability. However, the assumption <span class="math inline">\((3,5)\)</span> is also reasonable, with a
posterior probability of <span class="math inline">\(19.6\%\)</span>. So
it is up to us to decide which one to choose.</p>
<p>Remember that with the assumption <span class="math inline">\((3,5)\)</span>, the <code>n0</code> will be 4,
which would be insufficient for us to estimate covariance correctly. The
assumption <span class="math inline">\((3,4,5)\)</span> will be just
right:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S_projected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project_matrix.html">project_matrix</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">g_map</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">S_projected</span></span>
<span><span class="co">#&gt;            [,1]       [,2]       [,3]      [,4]      [,5]</span></span>
<span><span class="co">#&gt; [1,] 17.5271465 12.3563637 -0.9478352 2.3204390 2.3204390</span></span>
<span><span class="co">#&gt; [2,] 12.3563637  8.7673141 -0.7032989 1.5890268 1.5890268</span></span>
<span><span class="co">#&gt; [3,] -0.9478352 -0.7032989  0.6670038 0.1938152 0.1938152</span></span>
<span><span class="co">#&gt; [4,]  2.3204390  1.5890268  0.1938152 0.5373861 0.4384255</span></span>
<span><span class="co">#&gt; [5,]  2.3204390  1.5890268  0.1938152 0.4384255 0.5373861</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">S_projected</span><span class="op">)</span><span class="op">$</span><span class="va">values</span> <span class="op">&gt;</span> <span class="fl">0.00000001</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4</span></span></code></pre></div>
<p>Now, the estimated covariance matrix is of full rank (5).</p>
</div>
<div class="section level2">
<h2 id="practical-example">Practical example<a class="anchor" aria-label="anchor" href="#practical-example"></a>
</h2>
<p>Let’s examine 12 books’ thick, height, and breadth data:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PrzeChoj/gips" class="external-link">gips</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span><span class="fu">DAAG</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/DAAG/man/oddbooks.html" class="external-link">oddbooks</a></span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">number_of_observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># 12</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># 3</span></span>
<span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span></span>
<span><span class="va">S</span></span>
<span><span class="co">#&gt;             thick    height   breadth</span></span>
<span><span class="co">#&gt; thick    72.69697 -40.33485 -31.74242</span></span>
<span><span class="co">#&gt; height  -40.33485  25.36992  20.58576</span></span>
<span><span class="co">#&gt; breadth -31.74242  20.58576  17.18424</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gips.html">gips</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">number_of_observations</span>, D_matrix<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="co"># the default D_matrix</span></span>
<span><span class="fu">my_add_text</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span>, type <span class="op">=</span> <span class="st">"heatmap"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="gips_files/figure-html/change_D_matrix_example1-1.png" width="700"></p>
<p>We can see similarities between columns 2 and 3, representing the
book’s height and breadth. In particular, the covariance between [1,2]
is very similar to [1,3], and the variance of [2] is similar to the
variance of [3]. Those are not surprising, given the interpretation of
the data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_MAP.html">find_MAP</a></span><span class="op">(</span><span class="va">g</span>, optimizer <span class="op">=</span> <span class="st">"brute_force"</span>,</span>
<span>                  return_probabilities <span class="op">=</span> <span class="cn">TRUE</span>, save_all_perms <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span></span>
<span><span class="va">g_map</span></span>
<span><span class="co">#&gt; The permutation ()</span></span>
<span><span class="co">#&gt;  - was found after 6 log_posteriori calculations</span></span>
<span><span class="co">#&gt;  - is 1 times more likely than the starting, () permutation.</span></span>
<span><span class="fu"><a href="../reference/get_probabilities_from_gips.html">get_probabilities_from_gips</a></span><span class="op">(</span><span class="va">g_map</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   ()                (2,3)                (1,2) </span></span>
<span><span class="co">#&gt; 0.917699644399123216 0.082300333638115772 0.000000000064309861 </span></span>
<span><span class="co">#&gt;              (1,2,3)                (1,3) </span></span>
<span><span class="co">#&gt; 0.000000021892918704 0.000000000005532453</span></span></code></pre></div>
<p>We see the search was too restrictive and did not find the
permutation. We will weaken the restrictions by changing the
<code>D_matrix</code> parameter.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gips.html">gips</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">number_of_observations</span>, D_matrix<span class="op">=</span><span class="fl">0.05</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_MAP.html">find_MAP</a></span><span class="op">(</span><span class="va">g</span>, optimizer <span class="op">=</span> <span class="st">"brute_force"</span>,</span>
<span>                  return_probabilities <span class="op">=</span> <span class="cn">TRUE</span>, save_all_perms <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span></span>
<span><span class="va">g_map</span></span>
<span><span class="co">#&gt; The permutation (2,3)</span></span>
<span><span class="co">#&gt;  - was found after 6 log_posteriori calculations</span></span>
<span><span class="co">#&gt;  - is 3.58 times more likely than the starting, () permutation.</span></span>
<span><span class="fu"><a href="../reference/get_probabilities_from_gips.html">get_probabilities_from_gips</a></span><span class="op">(</span><span class="va">g_map</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  ()               (2,3)               (1,2)             (1,2,3) </span></span>
<span><span class="co">#&gt; 0.21834865211409399 0.78161461578574387 0.00000000027813589 0.00003673179839076 </span></span>
<span><span class="co">#&gt;               (1,3) </span></span>
<span><span class="co">#&gt; 0.00000000002363545</span></span></code></pre></div>
<p><code>find_MAP</code> found the symmetry represented by permutation
(2,3). The result depends on two input parameters, <code>delta</code>
and <code>D_matrix</code>. By default they are set to <code>3</code> and
<code>diag(p)</code>, respectively.</p>
<p>The method is not scale-invariant and therefore we recommend to run
gips for different values of <code>D_matrix</code> (typically, of the
form <code>C * diag(p)</code>).</p>
</div>
<div class="section level2">
<h2 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<ol style="list-style-type: decimal">
<li>To learn more about the available optimizers in
<code><a href="../reference/find_MAP.html">find_MAP()</a></code> and how to use those, see
<code><a href="../articles/Optimizers.html">vignette("Optimizers", package="gips")</a></code> or its <a href="https://przechoj.github.io/gips/articles/Optimizers.html">pkgdown
page</a>.</li>
<li>To learn more about the math and theory behind the <code>gips</code>
package, see <code><a href="../articles/Theory.html">vignette("Theory", package="gips")</a></code> or its <a href="https://przechoj.github.io/gips/articles/Theory.html">pkgdown
page</a>.</li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Adam Przemysław Chojecki, Paweł Morgen, Bartosz Kołodziejek.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
