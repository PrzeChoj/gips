<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="gips">
<title>gips • gips</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="gips">
<meta property="og:description" content="gips">
<meta property="og:image" content="https://przechoj.github.io/gips/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gips</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.9003</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/gips.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Optimizers.html">Optimizers</a>
    <a class="dropdown-item" href="../articles/Theory.html">Theory</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/PrzeChoj/gips/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>gips</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/PrzeChoj/gips/blob/HEAD/vignettes/gips.Rmd" class="external-link"><code>vignettes/gips.Rmd</code></a></small>
      <div class="d-none name"><code>gips.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-problem">The problem<a class="anchor" aria-label="anchor" href="#the-problem"></a>
</h2>
<p>Quite often, we have too little data to perform valid inference.
Consider the situation with multivariate Gaussian distribution, where we
have few observations compared to the number of variables. For example,
that’s the case for graphical models used in biology or medicine. In
such a setting, the usual way of finding the covariance matrix (the
maximum likelihood method) isn’t statistically applicable. What now?</p>
</div>
<div class="section level2">
<h2 id="invariance-by-permutation">Invariance by permutation<a class="anchor" aria-label="anchor" href="#invariance-by-permutation"></a>
</h2>
<p>In some cases, the interchange of variables in the vector does not
change its distribution. In the multivariate Gaussian case, it would
mean that they have the same variances and covariances with other
respective variables. For instance, in the following covariance matrix,
variables X1 and X3 are interchangeable, meaning that vectors (X1, X2,
X3) and (X3, X2, X1) have the same distribution.</p>
<p><img src="gips_files/figure-html/symvariant_matrix-1.png" width="700"></p>
<p>Now, we can state this interchangeability property in terms of
permutations. In our case, the distribution of (X1, X2, X3) is
<strong>invariant by permutation</strong> (<span class="math inline">\(1\mapsto3\)</span>, <span class="math inline">\(3\mapsto1\)</span>), or in cyclic form <span class="math inline">\((1,3)(2)\)</span>. This is equivalent to saying
that swapping the first with the third row and then swapping the first
and third columns of the covariance matrix results in the same matrix.
Then we say that this covariance matrix is <strong>invariant by
permutation</strong>.</p>
<p>Of course, in the samples collected in the real world, no perfect
equalities will be observed. Still, if the respective values in the
(poorly) estimated covariance matrix were close, adopting a particular
assumption about invariance by permutation would be a reasonable
step.</p>
</div>
<div class="section level2">
<h2 id="package-gips">Package <code>gips</code><a class="anchor" aria-label="anchor" href="#package-gips"></a>
</h2>
<p>We propose creating a set of constraints on the covariance matrix to
use the maximum likelihood method. The constraint we consider is - none
other than - invariance under permutation symmetry.</p>
<p>This package provides a way to find a <em>reasonable</em> permutation
to be used as a constraint in covariance matrix estimation. In this
case, <em>reasonable</em> means maximizing the Bayesian posterior
distribution when using a Wishart-like distribution on symmetric,
positive definite matrices as a prior. The idea, exact formulas, and
algorithm sketch are explored in another vignette that can be accessed
by <code><a href="../articles/Theory.html">vignette("Theory", package="gips")</a></code> or on its <a href="https://przechoj.github.io/gips/articles/Theory.html">pkgdown
page</a>.</p>
</div>
<div class="section level2">
<h2 id="practical-example">Practical example<a class="anchor" aria-label="anchor" href="#practical-example"></a>
</h2>
<p>Let’s examine 12 books’ thick, height, and breadth data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PrzeChoj/gips" class="external-link">gips</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu">DAAG</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/DAAG/man/oddbooks.html" class="external-link">oddbooks</a></span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>We suspect books from this dataset were printed with <span class="math inline">\(\sqrt{2}\)</span> aspect ratio as in popular <a href="https://en.wikipedia.org/wiki/Paper_size#A_series" class="external-link">A series paper
size</a>. Therefore, we can use this expert knowledge in the analysis
and unify the data for height and width:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Z</span><span class="op">$</span><span class="va">height</span> <span class="op">&lt;-</span> <span class="va">Z</span><span class="op">$</span><span class="va">height</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s plot the data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">number_of_observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># 12</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># 3</span></span>
<span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">S</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;         thick height breadth</span></span>
<span><span class="co">#&gt; thick    72.7  -28.5   -31.7</span></span>
<span><span class="co">#&gt; height  -28.5   12.7    14.6</span></span>
<span><span class="co">#&gt; breadth -31.7   14.6    17.2</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gips.html">gips</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">number_of_observations</span>, D_matrix <span class="op">=</span> <span class="fl">1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="co"># the default D_matrix</span></span>
<span><span class="fu">my_add_text</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span>, type <span class="op">=</span> <span class="st">"heatmap"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Standard, MLE estimator of a covariance matrix"</span><span class="op">)</span></span></code></pre></div>
<p><img src="gips_files/figure-html/change_D_matrix_example1_2-1.png" width="700"></p>
<p>We can see similarities between columns 2 and 3, representing the
book’s height and breadth. In particular, the covariance between [1,2]
is very similar to [1,3], and the variance of [2] is similar to the
variance of [3]. Those are not surprising, given the interpretation of
the data (after the rescaling of height that we did).</p>
<p>Let’s see what the <code>gips</code> will tell about this data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_MAP.html">find_MAP</a></span><span class="op">(</span><span class="va">g</span>, optimizer <span class="op">=</span> <span class="st">"brute_force"</span>,</span>
<span>                  return_probabilities <span class="op">=</span> <span class="cn">TRUE</span>, save_all_perms <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span></span>
<span><span class="va">g_map</span></span>
<span><span class="co">#&gt; The permutation ():</span></span>
<span><span class="co">#&gt;  - was found after 6 posteriori calculations;</span></span>
<span><span class="co">#&gt;  - is 1 times more likely than the () permutation.</span></span>
<span><span class="fu"><a href="../reference/get_probabilities_from_gips.html">get_probabilities_from_gips</a></span><span class="op">(</span><span class="va">g_map</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  ()               (2,3)             (1,2,3)               (1,3) </span></span>
<span><span class="co">#&gt; 0.68266498062075265 0.31733501720532475 0.00000000216167368 0.00000000001053803 </span></span>
<span><span class="co">#&gt;               (1,2) </span></span>
<span><span class="co">#&gt; 0.00000000000171083</span></span></code></pre></div>
<p>We see the search was too restrictive and did not find the
permutation. We will weaken the restrictions by changing the
<code>D_matrix</code> parameter.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">0.1</span> <span class="co"># smaller than 1, so gips will look for bigger structure</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gips.html">gips</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">number_of_observations</span>, D_matrix <span class="op">=</span> <span class="va">d</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_MAP.html">find_MAP</a></span><span class="op">(</span><span class="va">g</span>, optimizer <span class="op">=</span> <span class="st">"brute_force"</span>,</span>
<span>                  return_probabilities <span class="op">=</span> <span class="cn">TRUE</span>, save_all_perms <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span></span>
<span><span class="va">g_map</span></span>
<span><span class="co">#&gt; The permutation (2,3):</span></span>
<span><span class="co">#&gt;  - was found after 6 posteriori calculations;</span></span>
<span><span class="co">#&gt;  - is 3.143 times more likely than the () permutation.</span></span>
<span><span class="fu"><a href="../reference/get_probabilities_from_gips.html">get_probabilities_from_gips</a></span><span class="op">(</span><span class="va">g_map</span><span class="op">)</span></span>
<span><span class="co">#&gt;                (2,3)                   ()              (1,2,3) </span></span>
<span><span class="co">#&gt; 0.758618835154542648 0.241381031705867832 0.000000133131624193 </span></span>
<span><span class="co">#&gt;                (1,3)                (1,2) </span></span>
<span><span class="co">#&gt; 0.000000000006876633 0.000000000001088682</span></span></code></pre></div>
<p><code>find_MAP</code> found the symmetry represented by permutation
(2,3). The result depends on two input parameters, <code>delta</code>
and <code>D_matrix</code>. By default they are set to <code>3</code> and
<code>diag(p)</code>, respectively.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">my_add_text</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g_map</span>, type <span class="op">=</span> <span class="st">"heatmap"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="gips_files/figure-html/change_D_matrix_example4-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/project_matrix.html">project_matrix</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">g_map</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;         thick height breadth</span></span>
<span><span class="co">#&gt; thick    72.7  -30.1   -30.1</span></span>
<span><span class="co">#&gt; height  -30.1   14.9    14.6</span></span>
<span><span class="co">#&gt; breadth -30.1   14.6    14.9</span></span></code></pre></div>
<p>The method is not scale-invariant and therefore we recommend to run
gips for different values of <code>D_matrix</code> of the form
<code>D_matrix = d * diag(p)</code>, where <code>d</code> <span class="math inline">\(\in \mathbb{R}^+\)</span>).</p>
</div>
<div class="section level2">
<h2 id="theoretic-example">Theoretic example<a class="anchor" aria-label="anchor" href="#theoretic-example"></a>
</h2>
<div id="spoiler1" style="display:none">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perm_size</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">number_of_observations</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">perm_size</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span> <span class="co"># Assume we don't know the mean</span></span>
<span><span class="va">sigma_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>,   <span class="fl">3</span>,   <span class="fl">1.9</span>, <span class="fl">1.9</span>, <span class="fl">1.9</span>,</span>
<span>                         <span class="fl">3</span>,   <span class="fl">2.5</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>,</span>
<span>                         <span class="fl">1.9</span>, <span class="fl">0.3</span>, <span class="fl">1</span>,   <span class="fl">0.8</span>, <span class="fl">0.8</span>,</span>
<span>                         <span class="fl">1.9</span>, <span class="fl">0.3</span>, <span class="fl">0.8</span>, <span class="fl">1</span>,   <span class="fl">0.8</span>,</span>
<span>                         <span class="fl">1.9</span>, <span class="fl">0.3</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co"># sigma_matrix is a matrix invariant under permutation (3,4,5)</span></span>
<span><span class="va">toy_example_data</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">2022</span>,</span>
<span>    code <span class="op">=</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">number_of_observations</span>,</span>
<span>                         mu <span class="op">=</span> <span class="va">mu</span>, Sigma <span class="op">=</span> <span class="va">sigma_matrix</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<button title="Click to show the data preparation" type="button" onclick="if(document.getElementById('spoiler1') .style.display=='none')
              {document.getElementById('spoiler1') .style.display=''}
            else{document.getElementById('spoiler1') .style.display='none'}">
Show/hide data preparation
</button>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PrzeChoj/gips" class="external-link">gips</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">toy_example_data</span></span>
<span><span class="co">#&gt;           [,1]       [,2]      [,3]       [,4]     [,5]</span></span>
<span><span class="co">#&gt; [1,]  2.598402  -8.794831 2.2679420 -0.6248702 7.396473</span></span>
<span><span class="co">#&gt; [2,] -3.398518 -13.611837 2.7447209 -0.6429609 7.190809</span></span>
<span><span class="co">#&gt; [3,] -2.362805 -11.664733 1.6779458 -2.2529833 6.826879</span></span>
<span><span class="co">#&gt; [4,] -4.302042 -10.405734 0.8324382 -3.0326452 5.945698</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">toy_example_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4 5</span></span>
<span><span class="va">number_of_observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">toy_example_data</span><span class="op">)</span> <span class="co"># 4</span></span>
<span><span class="va">perm_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">toy_example_data</span><span class="op">)</span> <span class="co"># 5</span></span>
<span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">toy_example_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span><span class="op">$</span><span class="va">values</span> <span class="op">&gt;</span> <span class="fl">0.00000001</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<p>Note that the rank of the <code>S</code> matrix is 3, despite the
<code>number_of_observations</code> being 4. This is because
<code><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov()</a></code> estimated the mean on every column to compute
<code>S</code>.</p>
<p>We want to find reasonable additional assumptions on <code>S</code>
to make it easier to estimate.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gips.html">gips</a></span><span class="op">(</span>S <span class="op">=</span> <span class="va">S</span>, number_of_observations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">toy_example_data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span>, type <span class="op">=</span> <span class="st">"heatmap"</span><span class="op">)</span></span></code></pre></div>
<p><img src="gips_files/figure-html/toy_example_data_show2-1.png" width="700"></p>
<p>Looking at the plot, one can see the similarities between columns 3,
4, and 5. They have similar variance and covariance to each other. The 3
and 5 have similar covariance with columns 1 and 2. However, the 4 is
not far from them.</p>
<p>Let’s see if <code>gips</code> will find the relationship:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_MAP.html">find_MAP</a></span><span class="op">(</span><span class="va">g</span>, optimizer <span class="op">=</span> <span class="st">"brute_force"</span>,</span>
<span>                  return_probabilities <span class="op">=</span> <span class="cn">TRUE</span>, save_all_perms <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g_map</span>, type <span class="op">=</span> <span class="st">"heatmap"</span><span class="op">)</span></span></code></pre></div>
<p><img src="gips_files/figure-html/toy_example_data_show3-1.png" width="700"></p>
<p><code>gips</code> decided that <span class="math inline">\((3,4,5)\)</span> was the most reasonable
assumption. Let’s see how much better it is:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g_map</span></span>
<span><span class="co">#&gt; The permutation (3,4,5):</span></span>
<span><span class="co">#&gt;  - was found after 120 posteriori calculations;</span></span>
<span><span class="co">#&gt;  - is 19.055 times more likely than the () permutation.</span></span></code></pre></div>
<p>This assumption is nineteen times more believable than making no
assumption. Let’s examine how reasonable are other possible
assumptions:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_probabilities_from_gips.html">get_probabilities_from_gips</a></span><span class="op">(</span><span class="va">g_map</span><span class="op">)</span></span>
<span><span class="co">#&gt;       (3,4,5)       (2,3,4)     (2,4,3,5)     (2,3,4,5)         (3,5) </span></span>
<span><span class="co">#&gt; 0.19437057372 0.10939068692 0.06508290817 0.05997502664 0.05766471854 </span></span>
<span><span class="co">#&gt;     (2,3,5,4)  (1,2)(3,4,5)    (2,4)(3,5)         (3,4)         (4,5) </span></span>
<span><span class="co">#&gt; 0.05632735311 0.05423742756 0.05080997459 0.04329634843 0.04202785057 </span></span>
<span><span class="co">#&gt;       (2,4,5)  (1,2,4)(3,5)         (2,4)       (2,3,5)    (1,2)(3,4) </span></span>
<span><span class="co">#&gt; 0.03320169611 0.02887122147 0.01791226854 0.01690766133 0.01061327379 </span></span>
<span><span class="co">#&gt;    (1,2)(4,5)            ()     (1,2,3,4)    (1,2)(3,5)    (2,3)(4,5) </span></span>
<span><span class="co">#&gt; 0.01041554609 0.01020026297 0.00951704076 0.00946452342 0.00941299231 </span></span>
<span><span class="co">#&gt;   (1,2,5,3,4)    (2,5)(3,4)       (1,2,4)         (2,3)     (1,3,2,4) </span></span>
<span><span class="co">#&gt; 0.00812066874 0.00772947942 0.00712466828 0.00688837275 0.00688583190 </span></span>
<span><span class="co">#&gt;  (1,4)(2,3,5)  (1,5)(2,3,4)         (2,5)  (1,2,3)(4,5)  (1,3)(2,4,5) </span></span>
<span><span class="co">#&gt; 0.00625599338 0.00517631271 0.00484877434 0.00480180013 0.00450718929 </span></span>
<span><span class="co">#&gt;         (1,2)  (1,2,5)(3,4)   (1,2,3,5,4)     (1,2,4,3)   (1,2,5,4,3) </span></span>
<span><span class="co">#&gt; 0.00427729677 0.00400435159 0.00400328060 0.00360419086 0.00351929348 </span></span>
<span><span class="co">#&gt;   (1,2,4,3,5)    (1,4)(3,5)   (1,2,3,4,5)   (1,2,4,5,3)     (1,2,5,4) </span></span>
<span><span class="co">#&gt; 0.00337308053 0.00335428231 0.00312987976 0.00255051418 0.00224822235 </span></span>
<span><span class="co">#&gt;       (1,2,3)    (1,4)(2,3)     (1,4,2,5)         (1,4)       (1,2,5) </span></span>
<span><span class="co">#&gt; 0.00177420561 0.00163974966 0.00128101281 0.00120119497 0.00120092585 </span></span>
<span><span class="co">#&gt;     (1,2,4,5)    (1,5)(3,4)     (1,3,2,5)     (1,2,5,3)    (1,3)(2,4) </span></span>
<span><span class="co">#&gt; 0.00074114062 0.00063165904 0.00054577004 0.00047460582 0.00046770144 </span></span>
<span><span class="co">#&gt;    (1,4)(2,5)    (1,3)(4,5)  (1,4,5)(2,3)     (1,2,3,5)       (1,3,4) </span></span>
<span><span class="co">#&gt; 0.00044077486 0.00041115851 0.00039079452 0.00037801146 0.00036876776 </span></span>
<span><span class="co">#&gt;       (1,4,5)  (1,3,5)(2,4)         (1,3)         (1,5)  (1,3,4)(2,5) </span></span>
<span><span class="co">#&gt; 0.00036585692 0.00035608326 0.00031501545 0.00023660865 0.00015520181 </span></span>
<span><span class="co">#&gt;       (1,3,5)    (1,3)(2,5)    (1,5)(2,4)    (1,5)(2,3)     (1,4,3,5) </span></span>
<span><span class="co">#&gt; 0.00011230786 0.00009249800 0.00008895438 0.00006669827 0.00006326803 </span></span>
<span><span class="co">#&gt;     (1,3,5,4)     (1,3,4,5) </span></span>
<span><span class="co">#&gt; 0.00004873652 0.00004845945</span></span></code></pre></div>
<p>We see that assumption <span class="math inline">\((3,4,5)\)</span>
is the most likely with <span class="math inline">\(20.2\%\)</span>
posterior probability. All other permutations are way less likely.</p>
<p>Remember that for the <code>n0</code> could still be to big for your
data. In this example the assumptions with transpositions (like <span class="math inline">\((3,5)\)</span>) will have the <code>n0</code>
<span class="math inline">\(= 4\)</span>, which would be insufficient
for us to estimate covariance correctly. The assumption <span class="math inline">\((3,4,5)\)</span> will be just right:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S_projected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project_matrix.html">project_matrix</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">g_map</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">S_projected</span></span>
<span><span class="co">#&gt;          [,1]       [,2]       [,3]       [,4]       [,5]</span></span>
<span><span class="co">#&gt; [1,] 9.486870  4.2433055  1.5435370  1.5435370  1.5435370</span></span>
<span><span class="co">#&gt; [2,] 4.243306  4.1408570 -0.3208554 -0.3208554 -0.3208554</span></span>
<span><span class="co">#&gt; [3,] 1.543537 -0.3208554  0.8454335  0.7183971  0.7183971</span></span>
<span><span class="co">#&gt; [4,] 1.543537 -0.3208554  0.7183971  0.8454335  0.7183971</span></span>
<span><span class="co">#&gt; [5,] 1.543537 -0.3208554  0.7183971  0.7183971  0.8454335</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">S_projected</span><span class="op">)</span><span class="op">$</span><span class="va">values</span> <span class="op">&gt;</span> <span class="fl">0.00000001</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5</span></span></code></pre></div>
<p>Now, the estimated covariance matrix is of full rank (5).</p>
</div>
<div class="section level2">
<h2 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<ol style="list-style-type: decimal">
<li>To learn more about the available optimizers in
<code><a href="../reference/find_MAP.html">find_MAP()</a></code> and how to use those, see
<code><a href="../articles/Optimizers.html">vignette("Optimizers", package="gips")</a></code> or its <a href="https://przechoj.github.io/gips/articles/Optimizers.html">pkgdown
page</a>.</li>
<li>To learn more about the math and theory behind the <code>gips</code>
package, see <code><a href="../articles/Theory.html">vignette("Theory", package="gips")</a></code> or its <a href="https://przechoj.github.io/gips/articles/Theory.html">pkgdown
page</a>.</li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Adam Przemysław Chojecki, Paweł Morgen, Bartosz Kołodziejek.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
