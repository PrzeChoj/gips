<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="gips">
<title>Optimizers • gips</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimizers">
<meta property="og:description" content="gips">
<meta property="og:image" content="https://przechoj.github.io/gips/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gips</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.9004</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/gips.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Optimizers.html">Optimizers</a>
    <a class="dropdown-item" href="../articles/Theory.html">Theory</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/PrzeChoj/gips/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Optimizers</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/PrzeChoj/gips/blob/HEAD/vignettes/Optimizers.Rmd" class="external-link"><code>vignettes/Optimizers.Rmd</code></a></small>
      <div class="d-none name"><code>Optimizers.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PrzeChoj/gips" class="external-link">gips</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">find_MAP</span></span></code></pre></div>
<div class="section level2">
<h2 id="what-are-we-optimizing">What are we optimizing?<a class="anchor" aria-label="anchor" href="#what-are-we-optimizing"></a>
</h2>
<p>The goal of the <code><a href="../reference/find_MAP.html">find_MAP()</a></code> is to find the permutation
<span class="math inline">\(\sigma\)</span> that maximizes the a
posteriori probability (MAP - Maximum A Posteriori). Such a permutation
represents the most plausible symmetry given the data.</p>
<p>This a posteriori probability function is described more in-depth in
the <strong>Bayesian model selection</strong> section of the
<code><a href="../articles/Theory.html">vignette("Theory", package="gips")</a></code>, also available as a <a href="https://przechoj.github.io/gips/articles/Theory.html">pkgdown
page</a>. <code>gips</code> can calculate the logarithm of it by
<code><a href="../reference/log_posteriori_of_gips.html">log_posteriori_of_gips()</a></code> function. In the following
paragraphs, we will refer to this a posteriori probability function as
<span class="math inline">\(f(\sigma)\)</span>.</p>
</div>
<div class="section level2">
<h2 id="available-optimizers">Available optimizers<a class="anchor" aria-label="anchor" href="#available-optimizers"></a>
</h2>
<p>The space of permutations is enormous - for the permutation of size
<span class="math inline">\(p\)</span>, the space of all permutations is
of size <span class="math inline">\(p!\)</span> (<span class="math inline">\(p\)</span> factorial). Even for <span class="math inline">\(p=10\)</span>, this space is practically
impossible to browse. This is why <code><a href="../reference/find_MAP.html">find_MAP()</a></code> implements
multiple (3) optimizers to choose from:</p>
<ul>
<li>
<code>"Metropolis_Hastings"</code>, <code>"MH"</code>
</li>
<li>
<code>"hill_climbing"</code>, <code>"HC"</code>
</li>
<li>
<code>"brute_force"</code>, <code>"BF"</code>,
<code>"full"</code>
</li>
</ul>
<p>In general, we recommend the Brute Force for <span class="math inline">\(p\le 8\)</span>.</p>
<p>For bigger <span class="math inline">\(p&gt;9\)</span>, we recommend
Metropolis-Hastings.</p>
<div class="section level4">
<h4 id="note-on-computation-time">Note on computation time<a class="anchor" aria-label="anchor" href="#note-on-computation-time"></a>
</h4>
<p>The <code>max_iter</code> parameter functions differently in
Metropolis-Hastings and hill climbing.</p>
<p>For Metropolis-Hastings, it computes a posteriori of
<code>max_iter</code> permutations, whereas for hill climbing, it
computes <span class="math inline">\({p\choose 2} \cdot\)</span>
<code>max_iter</code> of them.</p>
<p>In the case of the Brute Force optimizer, it computes all <span class="math inline">\(p!\)</span> of <span class="math inline">\(f(\sigma)\)</span> values.</p>
</div>
<div class="section level3">
<h3 id="metropolis-hastings">Metropolis Hastings<a class="anchor" aria-label="anchor" href="#metropolis-hastings"></a>
</h3>
<p>This optimizer is implementation of the <em>Second approach</em> from
<a href="https://arxiv.org/abs/2004.03503" class="external-link">[1, Sec 4.1.2]</a>.</p>
<p>This uses the Metropolis-Hastings algorithm to optimize the space; <a href="https://en.wikipedia.org/wiki/Metropolis%E2%80%93Hastings_algorithm" class="external-link">see
Wikipedia</a>. This algorithm used in this context is a special case of
the Simulated Annealing the reader may be more familiar with; <a href="https://en.wikipedia.org/wiki/Simulated_annealing" class="external-link">see
Wikipedia</a>.</p>
<div class="section level4">
<h4 id="short-description">Short description<a class="anchor" aria-label="anchor" href="#short-description"></a>
</h4>
<p>In every iteration <span class="math inline">\(i\)</span>, an
algorithm is in a permutation, say, <span class="math inline">\(\sigma_i\)</span>. Then a random transposition is
drawn uniformly <span class="math inline">\(t_i = (j,k)\)</span> and the
value of <span class="math inline">\(f(\sigma_i \circ t_i)\)</span> is
computed.</p>
<ul>
<li>If new value is bigger than the previous one, (i.e. <span class="math inline">\(f(\sigma_i \circ t_i) \ge f(\sigma_i)\)</span>),
then we set <span class="math inline">\(\sigma_{i+1} = \sigma_i \circ
t_i\)</span>.</li>
<li>If new value is smaller (<span class="math inline">\(f(\sigma_i
\circ t_i) &lt; f(\sigma_i)\)</span>), then we will choose <span class="math inline">\(\sigma_{i+1} = \sigma_i \circ t_i\)</span> with
probability <span class="math inline">\(\frac{f(\sigma_i \circ
t_i)}{f(\sigma_i)}\)</span>. Otherwise, we set <span class="math inline">\(\sigma_{i+1} = \sigma_i\)</span> with
complementary probability <span class="math inline">\(1 -
\frac{f(\sigma_i \circ t_i)}{f(\sigma_i)}\)</span>.</li>
</ul>
<p>The final value is the best <span class="math inline">\(\sigma\)</span> that was ever computed.</p>
</div>
<div class="section level4">
<h4 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a>
</h4>
<p>This algorithm was tested in multiple settings and turned out to be
an outstanding optimizer. Especially given it does not need any
hyperparameters tuned.</p>
<p>The only parameter it depends on is <code>max_iter</code>, which
determines the number of steps described above. One should choose this
number rationally. When decided too small, there is a missed opportunity
to find potentially a much better permutation. When decided too big,
there is a lost time and computational power that does not lead to
growth. Our recommendation is to plot the convergence plot with a
logarithmic OX scale:
<code>plot(g_map, type = "both", logarithmic_x = TRUE)</code>. Then
decide if the line has flattened already. Keep in mind that the OY scale
is also logarithmic. For example, a small change on the OY scale could
mean <span class="math inline">\(10000\)</span> <strong>times</strong>
the change in A Posteriori.</p>
<p>If one decides to continue the optimization, see the
<strong>Continuation of the optimization</strong> section below.</p>
<p>This algorithm has been analyzed extensively by statisticians. Thanks
to the ergodic theorem, the frequency of visits of a given state
converges almost surely to the probability of that state. This is the
approach explained in the <a href="https://arxiv.org/abs/2004.03503" class="external-link">[1,
Sec.4.1.2]</a> and shown in <a href="https://arxiv.org/abs/2004.03503" class="external-link">[1, Sec. 5.2]</a>. One can
obtain estimates of posterior probabilities by setting
<code>return_probabilities = TRUE</code>.</p>
</div>
<div class="section level4">
<h4 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h4>
<div id="spoiler1" style="display:none">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perm_size</span> <span class="op">&lt;-</span> <span class="fl">70</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">perm_size</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span> <span class="co"># Assume we don't know the mean</span></span>
<span><span class="va">sigma_matrix</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">x</span><span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">perm_size</span><span class="op">*</span><span class="va">perm_size</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">perm_size</span><span class="op">)</span><span class="op">)</span> <span class="co"># the real covariance matrix, that we want to estimate</span></span>
<span><span class="va">number_of_observations</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">2022</span>,</span>
<span>    code <span class="op">=</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">number_of_observations</span>, mu <span class="op">=</span> <span class="va">mu</span>, Sigma <span class="op">=</span> <span class="va">sigma_matrix</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<button title="Click to show the data preparation" type="button" onclick="if(document.getElementById('spoiler1') .style.display=='none')
              {document.getElementById('spoiler1') .style.display=''}
            else{document.getElementById('spoiler1') .style.display='none'}">
Show/hide data preparation
</button>
<p>Let’s say we have the data <code>Z</code> from the unknown
process:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 50 70</span></span>
<span><span class="va">number_of_observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># 50</span></span>
<span><span class="va">perm_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># 70</span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># Assume we have to estimate the mean</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gips.html">gips</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">number_of_observations</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span> <span class="co"># message from ggplot2</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span>, type <span class="op">=</span> <span class="st">"heatmap"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span>,<span class="fl">70</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span>,<span class="fl">60</span>,<span class="fl">70</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Optimizers_files/figure-html/Metropolis_Hastings_2-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_MAP.html">find_MAP</a></span><span class="op">(</span><span class="va">g</span>, max_iter <span class="op">=</span> <span class="fl">150</span>, optimizer <span class="op">=</span> <span class="st">"Metropolis_Hastings"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===============================================================================</span></span>
<span><span class="va">g_map</span></span>
<span><span class="co">#&gt; The permutation (1,6,30,21,41,70,62,69,17,38,55,20,50,37,65,35,49,66,61,2,39,7,10,56,16,51,47,24,42,33,23,57,8,29,3,46,28,64,58,68,13,48,63,45,26,11,19,12,4,22,9,54,25,59,52,67,15,18,36,31,34,43,44,27,60,53,14,40,32):</span></span>
<span><span class="co">#&gt;  - was found after 150 posteriori calculations;</span></span>
<span><span class="co">#&gt;  - is 1.072e+2697 times more likely than the () permutation.</span></span></code></pre></div>
<p>After just hundred and fifty iterations, the found permutation is
unimaginably more likely than the original, <code>()</code>
permutation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g_map</span>, type <span class="op">=</span> <span class="st">"both"</span>, logarithmic_x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Optimizers_files/figure-html/Metropolis_Hastings_3-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="hill-climbing">Hill climbing<a class="anchor" aria-label="anchor" href="#hill-climbing"></a>
</h3>
<p>It uses the Hill climbing algorithm to optimize the space; <a href="https://en.wikipedia.org/wiki/Hill_climbing" class="external-link">see
Wikipedia</a>.</p>
<p>It is performing the local optimization iteratively.</p>
<div class="section level4">
<h4 id="short-description-1">Short description<a class="anchor" aria-label="anchor" href="#short-description-1"></a>
</h4>
<p>In every iteration <span class="math inline">\(i\)</span>, an
algorithm is in a permutation; call it <span class="math inline">\(\sigma_i\)</span>. Then all the values of <span class="math inline">\(f(\sigma_i \circ t)\)</span> are computed for
every possible transposition <span class="math inline">\(t =
(j,k)\)</span>. Then the next <span class="math inline">\(\sigma_{i+1}\)</span> will be the one with the
biggest value:</p>
<p><span class="math display">\[\sigma_{i+1} = argmax_{\text{perm} \in
\text{neighbors}(\sigma_{i})}\{\text{posteriori}(perm)\}\]</span></p>
<p>Where: <span class="math display">\[\text{neighbors}(\sigma) =
\{\sigma \circ (j,k) : 1 \le j &lt; k \le \text{p}\}\]</span></p>
<p>The algorithm ends when all neighbors are less likely, or the
<code>max_iter</code> was achieved. In the first case, the algorithm
will end in a local maximum, but there is no guarantee that this is also
the global maximum.</p>
</div>
<div class="section level4">
<h4 id="pseudocode">Pseudocode<a class="anchor" aria-label="anchor" href="#pseudocode"></a>
</h4>
<div id="spoiler2" style="display:none">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hill_climb</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">g</span>, <span class="va">max_iter</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">perm</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">perm_posteriori</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/log_posteriori_of_gips.html">log_posteriori_of_gips</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span>  <span class="va">perm_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">perm</span>, <span class="st">"size"</span><span class="op">)</span></span>
<span>  <span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">g</span>, <span class="st">"S"</span><span class="op">)</span></span>
<span>  <span class="va">number_of_observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">g</span>, <span class="st">"number_of_observations"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">best_neighbor</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">best_neighbor_posteriori</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="cn">Inf</span></span>
<span>  </span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  </span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="va">best_neighbor_posteriori</span> <span class="op">&gt;</span> <span class="va">perm_posteriori</span> <span class="op">&amp;&amp;</span> <span class="va">i</span> <span class="op">&lt;</span> <span class="va">max_iter</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">best_neighbor</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>    <span class="va">best_neighbor_posteriori</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="cn">Inf</span></span>
<span>    </span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">perm_size</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="op">(</span><span class="va">j</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">perm_size</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">neighbor</span> <span class="op">&lt;-</span> <span class="fu">gips</span><span class="fu">:::</span><span class="fu">compose_with_transposition</span><span class="op">(</span><span class="va">perm</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">j</span>, <span class="va">k</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">neighbor_posteriori</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/log_posteriori_of_gips.html">log_posteriori_of_gips</a></span><span class="op">(</span><span class="fu"><a href="../reference/gips.html">gips</a></span><span class="op">(</span></span>
<span>          <span class="va">S</span>,</span>
<span>          <span class="va">number_of_observations</span>,</span>
<span>          perm <span class="op">=</span> <span class="va">neighbor</span></span>
<span>        <span class="op">)</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">neighbor_posteriori</span> <span class="op">&gt;</span> <span class="va">best_neighbor_posteriori</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">best_neighbor</span> <span class="op">&lt;-</span> <span class="va">neighbor</span></span>
<span>          <span class="va">best_neighbor_posteriori</span> <span class="op">&lt;-</span> <span class="va">neighbor_posteriori</span></span>
<span>        <span class="op">}</span> <span class="co"># end if</span></span>
<span>      <span class="op">}</span> <span class="co"># end for k</span></span>
<span>    <span class="op">}</span> <span class="co"># end for j</span></span>
<span>    <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span> <span class="co"># end while</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">best_neighbor</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<button title="Click to show pseudocode" type="button" onclick="if(document.getElementById('spoiler2') .style.display=='none')
              {document.getElementById('spoiler2') .style.display=''}
            else{document.getElementById('spoiler2') .style.display='none'}">
Show/hide pseudocode
</button>
</div>
<div class="section level4">
<h4 id="example-1">Example<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h4>
<div id="spoiler3" style="display:none">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perm_size</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">perm_size</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span> <span class="co"># Assume we don't know the mean</span></span>
<span><span class="va">sigma_matrix</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">x</span><span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">perm_size</span><span class="op">*</span><span class="va">perm_size</span><span class="op">)</span>, nrow<span class="op">=</span><span class="va">perm_size</span><span class="op">)</span><span class="op">)</span> <span class="co"># the real covariance matrix, that we want to estimate</span></span>
<span><span class="va">number_of_observations</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">2022</span>,</span>
<span>    code <span class="op">=</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">number_of_observations</span>, mu <span class="op">=</span> <span class="va">mu</span>, Sigma <span class="op">=</span> <span class="va">sigma_matrix</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<button title="Click to show the data preparation" type="button" onclick="if(document.getElementById('spoiler3') .style.display=='none')
              {document.getElementById('spoiler3') .style.display=''}
            else{document.getElementById('spoiler3') .style.display='none'}">
Show/hide data preparation
</button>
<p>Let’s say we have the data Z from the unknown process:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20 25</span></span>
<span><span class="va">number_of_observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># 20</span></span>
<span><span class="va">perm_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># 25</span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># Assume we have to estimate the mean</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gips.html">gips</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">number_of_observations</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span>, type <span class="op">=</span> <span class="st">"heatmap"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Optimizers_files/figure-html/hill_climbing_2-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_MAP.html">find_MAP</a></span><span class="op">(</span><span class="va">g</span>, max_iter <span class="op">=</span> <span class="fl">2</span>, optimizer <span class="op">=</span> <span class="st">"hill_climbing"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; Warning: Hill Climbing algorithm did not converge in 2 iterations!</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> We recommend to run the `find_MAP(optimizer = 'continue')` on the acquired output.</span></span>
<span><span class="co">#&gt; Warning: The found permutation has n0 = 24 which is bigger than the number_of_observations = 20.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> The covariance matrix invariant under the found permutation does not have the likelihood properly defined.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> For more in-depth explanation, see 'Project Matrix - Equation (6)' section in `vignette('Theory', package = 'gips')` or its pkgdown page: https://przechoj.github.io/gips/articles/Theory.html.</span></span>
<span><span class="va">g_map</span></span>
<span><span class="co">#&gt; The permutation (20,22,23):</span></span>
<span><span class="co">#&gt;  - was found after 601 posteriori calculations;</span></span>
<span><span class="co">#&gt;  - is 3.824e+30 times more likely than the () permutation.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g_map</span>, type <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Optimizers_files/figure-html/hill_climbing_2-2.png" width="700"></p>
<p>The above warning is expected.</p>
</div>
</div>
<div class="section level3">
<h3 id="brute-force">Brute Force<a class="anchor" aria-label="anchor" href="#brute-force"></a>
</h3>
<p>It searches through the whole space at once.</p>
<p>This is the only optimizer that will certainly find the actual MAP
Estimator.</p>
<p>This is <strong>only recommended</strong> for small spaces (<span class="math inline">\(p \le 8\)</span>). It can also browse bigger
spaces, but the required time is probably too long. On our machines, for
<span class="math inline">\(p = 9\)</span> the calculations takes around
5 hours. For <span class="math inline">\(p = 10\)</span> we expect
around 40 hours of computations.</p>
<div class="section level4">
<h4 id="example-2">Example<a class="anchor" aria-label="anchor" href="#example-2"></a>
</h4>
<div id="spoiler4" style="display:none">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perm_size</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">perm_size</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span> <span class="co"># Assume we don't know the mean</span></span>
<span><span class="va">sigma_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">1.0</span>, <span class="fl">0.8</span>, <span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>,</span>
<span>    <span class="fl">0.8</span>, <span class="fl">1.0</span>, <span class="fl">0.8</span>, <span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>,</span>
<span>    <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span>, <span class="fl">0.8</span>, <span class="fl">0.6</span>, <span class="fl">0.4</span>,</span>
<span>    <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span>, <span class="fl">0.8</span>, <span class="fl">0.6</span>,</span>
<span>    <span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span>, <span class="fl">0.8</span>,</span>
<span>    <span class="fl">0.8</span>, <span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="va">perm_size</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="co"># the real covariance matrix, that we want to estimate, is invariant under permutation (1,2,3,4,5,6)</span></span>
<span><span class="va">number_of_observations</span> <span class="op">&lt;-</span> <span class="fl">13</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">2022</span>,</span>
<span>    code <span class="op">=</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">number_of_observations</span>, mu <span class="op">=</span> <span class="va">mu</span>, Sigma <span class="op">=</span> <span class="va">sigma_matrix</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<button title="Click to show the data preparation" type="button" onclick="if(document.getElementById('spoiler4') .style.display=='none')
              {document.getElementById('spoiler4') .style.display=''}
            else{document.getElementById('spoiler4') .style.display='none'}">
Show/hide data preparation
</button>
<p>Let’s say we have the data Z from the unknown process:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 13  6</span></span>
<span><span class="va">number_of_observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># 13</span></span>
<span><span class="va">perm_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># 6</span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># Assume we have to estimate the mean</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gips.html">gips</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">number_of_observations</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_MAP.html">find_MAP</a></span><span class="op">(</span><span class="va">g</span>, optimizer <span class="op">=</span> <span class="st">"brute_force"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="va">g_map</span></span>
<span><span class="co">#&gt; The permutation (1,2,3,4,5,6):</span></span>
<span><span class="co">#&gt;  - was found after 720 posteriori calculations;</span></span>
<span><span class="co">#&gt;  - is 43706.314 times more likely than the () permutation.</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="continuation-of-the-optimization">Continuation of the optimization<a class="anchor" aria-label="anchor" href="#continuation-of-the-optimization"></a>
</h2>
<p>When <code>max_iter</code> is reached during Metropolis-Hastings or
hill climbing, the optimization stops and returns the result. Users are
expected to plot the result and determine if it has converged. If
necessary, users can continue the optimization, as shown below.</p>
<div id="spoiler5" style="display:none">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the same code as for generating example for Metripolis-Hastings above</span></span>
<span></span>
<span><span class="va">perm_size</span> <span class="op">&lt;-</span> <span class="fl">70</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">perm_size</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span> <span class="co"># Assume we don't know the mean</span></span>
<span><span class="va">sigma_matrix</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">x</span><span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">perm_size</span><span class="op">*</span><span class="va">perm_size</span><span class="op">)</span>, nrow<span class="op">=</span><span class="va">perm_size</span><span class="op">)</span><span class="op">)</span> <span class="co"># the real covariance matrix, that we want to estimate</span></span>
<span><span class="va">number_of_observations</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">2022</span>,</span>
<span>    code <span class="op">=</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="va">number_of_observations</span>, mu <span class="op">=</span> <span class="va">mu</span>, Sigma <span class="op">=</span> <span class="va">sigma_matrix</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 50 70</span></span>
<span><span class="va">number_of_observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># 50</span></span>
<span><span class="va">perm_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># 70</span></span>
<span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span> <span class="co"># Assume we have to estimate the mean</span></span></code></pre></div>
</div>
<button title="Click to show the data preparation" type="button" onclick="if(document.getElementById('spoiler5') .style.display=='none')
              {document.getElementById('spoiler5') .style.display=''}
            else{document.getElementById('spoiler5') .style.display='none'}">
Show/hide data preparation
</button>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gips.html">gips</a></span><span class="op">(</span><span class="va">S</span>, <span class="va">number_of_observations</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_MAP.html">find_MAP</a></span><span class="op">(</span><span class="va">g</span>, max_iter <span class="op">=</span> <span class="fl">50</span>, optimizer <span class="op">=</span> <span class="st">"Metropolis_Hastings"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ==============================================================================</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g_map</span>, type <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Optimizers_files/figure-html/continuation_2-1.png" width="700"></p>
<p>The algorithm was still significantly improving the permutation. It
is reasonable to continue it:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g_map2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_MAP.html">find_MAP</a></span><span class="op">(</span><span class="va">g_map</span>, max_iter <span class="op">=</span> <span class="fl">100</span>, optimizer <span class="op">=</span> <span class="st">"continue"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===============================================================================</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g_map2</span>, type <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Optimizers_files/figure-html/continuation_3-1.png" width="700"></p>
<p>The improvement has slowed down significantly. It is fair to stop the
algorithm here. Keep in mind the y scale is logarithmic. The visually
“small” improvement between 100 and 150 iterations was huge, <span class="math inline">\(10^{52}\)</span> times the posteriori.</p>
</div>
<div class="section level2">
<h2 id="additional-parameters">Additional parameters<a class="anchor" aria-label="anchor" href="#additional-parameters"></a>
</h2>
<p>The <code><a href="../reference/find_MAP.html">find_MAP()</a></code> function has two additional parameters:
<code>show_progress_bar</code> and <code>save_all_perms</code>, which
can be set to <code>TRUE</code> or <code>FALSE</code>.</p>
<p>When <code>show_progress_bar = TRUE</code>, <code>gips</code> will
print “=” characters on the console during optimization. Keep in mind
that when user sets the <code>return_probabilities = TRUE</code>, a
second progress bar will indicate the calculation of the probabilities
after optimization.</p>
<p>The <code>save_all_perms = TRUE</code> will save all visited
permutations in the outputted object, but this significantly increases
the required RAM. For instance, with <span class="math inline">\(p=150\)</span> and <code>max_perm = 150000</code>,
we needed 400 MB to store it, whereas
<code>save_all_perms = FALSE</code> only required 2 MB. However,
<code>save_all_perms = TRUE</code> is necessary for
<code>return_probabilities = TRUE</code> or more complex path
analysis.</p>
</div>
<div class="section level2">
<h2 id="discussion">Discussion<a class="anchor" aria-label="anchor" href="#discussion"></a>
</h2>
<p>We are considering implementing the <strong>First approach</strong>
from [1] in the future as well. In this approach, the Markov chain
travels along cyclic groups rather than permutations.</p>
<p>We encourage everyone to leave a comment on available and potential
new optimizers on the <a href="https://github.com/PrzeChoj/gips/issues/21" class="external-link">ISSUE#21</a>. There,
one can also find the implemented optimizers but not yet added to
<code>gips</code>.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>[1] Piotr Graczyk, Hideyuki Ishi, Bartosz Kołodziejek, Hélène Massam.
“Model selection in the space of Gaussian models invariant by symmetry.”
The Annals of Statistics, 50(3) 1747-1774 June 2022. <a href="https://arxiv.org/abs/2004.03503" class="external-link">arXiv link</a>; <a href="https://doi.org/10.1214/22-AOS2174" class="external-link">DOI:
10.1214/22-AOS2174</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Adam Przemysław Chojecki, Paweł Morgen, Bartosz Kołodziejek.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
